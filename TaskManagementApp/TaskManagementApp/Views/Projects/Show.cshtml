@model TaskManagementApp.Models.Project

@{
    ViewData["Title"] = Model.Title;
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />

<div class="container mt-5">
    <div class="card feature-card p-4 shadow-sm rounded-4">

        <h1 class="mb-3">@Model.Title</h1>
        <p class="lead">@Model.Description</p>

        <span class="badge bg-primary mb-3">
            Creat la: @Model.Date.ToShortDateString()
        </span>

        <h4 class="mt-4">Organizator</h4>
        <p><strong>@Model.Organizer.UserName</strong></p>

        <h4 class="mt-4">Membri proiect</h4>

        <h4 class="mt-4">Task-uri ale proiectului</h4>

        <div class="d-flex justify-content-end mb-3">
            @if ((ViewBag.EsteOrganizator ?? false)
                        || (ViewBag.EsteAdmin ?? false)
                        || (ViewBag.EsteMembru ?? false))
            {
                <a asp-controller="Tasks"
                   asp-action="New"
                   asp-route-projectId="@Model.Id"
                   class="btn btn-outline-success rounded-pill shadow-sm">
                    ➕ Adaugă Task
                </a>
            }
        </div>

        @if (Model.Tasks != null && Model.Tasks.Any())
        {
            <div class="row g-3">
                @foreach (var task in Model.Tasks)
                 {
                    <div class="col-md-4">
                        @await Html.PartialAsync("~/Views/Shared/_TaskCardPartial.cshtml", task)
                    </div>
                }
            </div>
        }
        else
        {
            <div class="alert alert-info">Nu există task-uri în acest proiect.</div>
        }

        <ul class="list-group mb-4 rounded-3 overflow-hidden shadow-sm">
            @foreach (var member in Model.ProjectMembers)
            {
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    @member.User.UserName
                    <span class="badge bg-secondary rounded-pill">@member.User.Email</span>
                </li>
            }
        </ul>

        <div class="mt-3">
            @if (ViewBag.EsteOrganizator || ViewBag.EsteAdmin)
            {
                <a asp-controller="Projects"
                   asp-action="Edit"
                   asp-route-id="@Model.Id"
                   class="btn btn-outline-warning rounded-pill me-2 shadow-sm">
                    ✏ Editează
                </a>

                <form asp-controller="Projects"
                      asp-action="Delete"
                      asp-route-id="@Model.Id"
                      method="post"
                      class="d-inline">
                    <button class="btn btn-outline-danger rounded-pill shadow-sm"
                            onclick="return confirm('Sigur ștergi proiectul?')">
                        🗑 Șterge
                    </button>
                </form>

                <a asp-controller="Projects"
                   asp-action="AddMember"
                   asp-route-projectId="@Model.Id"
                   class="btn btn-outline-success rounded-pill ms-2 shadow-sm">
                    ➕ Adaugă membri
                </a>
            }
        </div>

    </div>
</div>
