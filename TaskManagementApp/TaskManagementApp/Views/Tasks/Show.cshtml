@model TaskManagementApp.Models.Task

@{
    ViewData["Title"] = Model.Title;
    var userCurentId = User.FindFirst("sub")?.Value;
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />

<div class="container mt-5">
    <div class="card shadow-lg p-4 rounded-4">

        <h2 class="mb-3">@Model.Title</h2>

        <span class="badge bg-info p-2 fs-6">Status: @Model.Status</span>

        <p class="mt-4"><strong>Descriere:</strong> @Model.Description</p>

        @if (!string.IsNullOrEmpty(Model.Content))
        {
            <div class="mb-4">
                <strong>Conținut media:</strong>
                @if (Model.Content.Contains("youtube") || Model.Content.Contains("youtu.be"))
                {
                    <div class="ratio ratio-16x9 mt-2">
                        <iframe src="@Model.Content.Replace("watch?v=", "embed/")"
                                frameborder="0"
                                allowfullscreen
                                class="rounded"></iframe>
                    </div>
                }
                else if (Model.Content.EndsWith(".jpg") || Model.Content.EndsWith(".png") || Model.Content.EndsWith(".jpeg"))
                {
                    <img src="@Model.Content" class="img-fluid rounded mt-2" alt="Imagine Task" style="max-height: 400px; object-fit: cover;" />
                }
                else
                {
                    <p><a href="@Model.Content" target="_blank" class="text-break">Link: @Model.Content</a></p>
                }
            </div>
        }

        <hr class="my-3" />

        <div class="row">
            <div class="col-md-6">
                <p>
                    <strong>Start:</strong> @Model.StartDate.ToString("dd/MM/yyyy") <br />
                    <strong>End:</strong> @Model.EndDate.ToString("dd/MM/yyyy")
                </p>
            </div>
            <div class="col-md-6">
                <p>
                    <strong>Asignat:</strong>
                    @if (Model.User != null)
                    {
                        @Model.User.UserName
                    }
                    else
                    {
                        <span class="text-muted">Neasignat</span>
                    }
                </p>
            </div>
        </div>

        <div class="mt-3 d-flex">
            @if (ViewBag.EsteOrganizator == true || ViewBag.EsteAdmin == true || ViewBag.EsteMembru == true)
            {
                <a asp-controller="Tasks"
                   asp-action="Edit"
                   asp-route-id="@Model.Id"
                   class="btn btn-outline-warning rounded-pill me-2">
                    ✏ Editează
                </a>

                <form asp-controller="Tasks"
                      asp-action="Delete"
                      asp-route-id="@Model.Id"
                      method="post"
                      class="d-inline">
                    <button class="btn btn-outline-danger rounded-pill"
                            onclick="return confirm('Sunteți sigur că doriți să ștergeți acest task?');">
                        🗑 Șterge
                    </button>
                </form>
            }
        </div>

        <hr class="my-4" />

        <h4>Comentarii (@Model.Comments.Count)</h4>

        @await Html.PartialAsync("_CommentListPartial", Model.Comments.OrderByDescending(c => c.Date).ToList())

        @if (ViewBag.EsteMembru || ViewBag.EsteOrganizator || ViewBag.EsteAdmin)
        {
            <div class="card p-3 mt-4">
                <h6>Adaugă un comentariu</h6>
                <form asp-controller="Comments" asp-action="New" method="post">
                    <input type="hidden" name="TaskId" value="@Model.Id" />

                    <div class="mb-3">
                        <textarea name="Content" class="form-control" placeholder="Scrie un comentariu..." required></textarea>
                    </div>

                    <button class="btn btn-success rounded-pill">
                        Adaugă comentariu
                    </button>
                </form>
            </div>
        }
    </div>
</div>